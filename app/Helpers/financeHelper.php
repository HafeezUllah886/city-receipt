<?php
 use App\Models\account; use App\Models\expense; use App\Models\ledger; use App\Models\products; use App\Models\purchase; use App\Models\purchase_details; use App\Models\ref; use App\Models\sale; use App\Models\sale_details; use App\Models\stock; use App\Models\tasks; use App\Models\transactions; use Carbon\Carbon; goto UqXjZ; L1Bg7: function createTransaction($accountID, $date, $cr, $db, $notes, $ref) { transactions::create(array("\141\143\143\x6f\x75\156\x74\111\104" => $accountID, "\144\141\164\x65" => $date, "\143\x72" => $cr, "\144\x62" => $db, "\156\x6f\164\145\163" => $notes, "\x72\x65\146\x49\104" => $ref)); } goto YEnCc; TkRS0: function getPurchaseBillTotal($id) { $items = purchase_details::where("\142\151\x6c\x6c\x5f\x69\144", $id)->get(); $total = 0; $amount = 0; foreach ($items as $item) { $amount = $item->rate * $item->qty; $total += $amount; } return $total; } goto Sxi1U; sHycF: function todayBank() { $accounts = account::where("\x43\141\164\x65\147\x6f\162\171", "\102\141\156\153")->get(); $cr = 0; $db = 0; $balance = 0; $Date = Carbon::now()->format("\x59\x2d\x6d\x2d\x64"); foreach ($accounts as $account) { $cr = transactions::where("\x61\143\x63\157\x75\x6e\164\137\151\144", $account->id)->whereDate("\144\141\x74\x65", $Date)->sum("\x63\162"); $db = transactions::where("\x61\x63\x63\157\165\156\164\x5f\151\x64", $account->id)->whereDate("\x64\141\x74\145", $Date)->sum("\x64\x62"); $balance += $cr - $db; } return $balance; } goto TkRS0; i_6Ag: function todaySale() { $Date = Carbon::now()->format("\x59\55\155\x2d\x64"); $sales = sale_details::whereDate("\144\x61\x74\145", $Date)->get(); $total = 0; foreach ($sales as $item) { $total += $item->qty * $item->price; $total -= $item->bill->discount; } return $total; } goto nQYj0; Ss_X8: function todayExpense() { $Date = Carbon::now()->format("\x59\55\x6d\55\x64"); $exp = expense::whereDate("\144\x61\x74\145", $Date)->sum("\x61\155\157\165\x6e\x74"); return round($exp, 0); } goto VgCbl; wln7l: function vendorDues() { $accounts = account::where("\164\171\160\145", "\x76\x65\156\144\157\162")->get(); $cr = 0; $db = 0; $balance = 0; foreach ($accounts as $account) { $cr = transactions::where("\141\x63\x63\157\165\x6e\x74\x5f\x69\x64", $account->id)->sum("\x63\x72"); $db = transactions::where("\x61\x63\143\157\x75\156\164\x5f\x69\144", $account->id)->sum("\144\x62"); $balance += $cr - $db; } return $balance; } goto tFBls; BlImD: function task_badge() { $tasks = tasks::all(); $count = 0; foreach ($tasks as $task) { if ($task->status == "\x50\x65\x6e\x64\151\156\x67" && $task->due < now()) { $count += 1; } } return $count; } goto Dybcw; I6pRT: function previousCash($date) { $accounts = account::where("\103\x61\x74\145\147\157\x72\171", "\x43\141\x73\x68")->get(); $cr = 0; $db = 0; $balance = 0; foreach ($accounts as $account) { $cr = transactions::where("\141\143\143\x6f\x75\x6e\164\137\x69\144", $account->id)->whereDate("\x64\141\164\145", "\74", $date)->sum("\143\x72"); $db = transactions::where("\141\143\143\x6f\x75\156\164\x5f\151\x64", $account->id)->whereDate("\x64\x61\164\145", "\74", $date)->sum("\x64\142"); $balance += $cr - $db; } return $balance; } goto BlImD; UqXjZ: function getRef() { $ref = ref::first(); if ($ref) { $ref->ref = $ref->ref + 1; } else { $ref = new ref(); $ref->ref = 1; } $ref->save(); return $ref->ref; } goto L1Bg7; KgTYF: function updatePurchaseAmount($id) { $bill = purchase::where("\x69\144", $id)->first(); $total = getPurchaseBillTotal($id); if ($bill->isPaid == "\x4e\157") { if ($bill->vendor_account->type == "\126\145\x6e\144\x6f\x72") { $trans = transactions::where("\141\143\x63\157\165\x6e\x74\x5f\x69\144", $bill->vendor_account->id)->where("\x72\145\146", $bill->ref)->get(); foreach ($trans as $tran) { $tran->cr = $total; $tran->date = $bill->date; $tran->save(); } } else { $trans = transactions::where("\x61\x63\x63\157\x75\156\x74\x5f\x69\x64", $bill->vendor_account->id)->where("\162\x65\x66", $bill->ref)->get(); foreach ($trans as $tran) { $tran->db = $total; $tran->date = $bill->date; $tran->save(); } } $trans->save(); } elseif ($bill->isPaid == "\x59\x65\163") { $trans = transactions::where("\x61\143\x63\x6f\x75\x6e\164\x5f\x69\x64", $bill->account->id)->where("\x72\145\x66", $bill->ref)->get(); foreach ($trans as $tran) { $tran->db = $total; $tran->date = $bill->date; $tran->save(); } $trans = transactions::where("\x61\x63\143\157\165\x6e\x74\x5f\x69\144", $bill->vendor_account->id)->where("\162\145\146", $bill->ref)->get(); foreach ($trans as $tran) { $tran->db = $total; $tran->cr = $total; $tran->date = $bill->date; $tran->save(); } } else { if ($bill->vendor_account->type == "\126\x65\156\x64\157\x72") { $trans = transactions::where("\x61\143\x63\157\x75\156\164\137\151\x64", $bill->vendor_account->id)->where("\162\145\x66", $bill->ref)->get(); foreach ($trans as $tran) { $tran->cr = $total; $tran->date = $bill->date; $tran->save(); } } else { $trans = transactions::where("\x61\143\x63\157\165\x6e\164\x5f\x69\144", $bill->vendor_account->id)->where("\162\x65\146", $bill->ref)->get(); foreach ($trans as $tran) { $tran->db = $total; $tran->date = $bill->date; $tran->save(); } } } } goto KP_u0; Sxi1U: function getSaleBillTotal($id) { $items = sale_details::where("\142\x69\x6c\154\x5f\x69\144", $id)->get(); $total = 0; $amount = 0; foreach ($items as $item) { $amount = ($item->price - $item->discount) * $item->qty; $total += $amount; } $bill = sale::find($id); $total = $total - $bill->discount + $bill->dc; return $total; } goto KgTYF; tFBls: function totalCash() { $accounts = account::where("\103\141\164\x65\147\157\162\x79", "\x43\x61\x73\x68")->get(); $cr = 0; $db = 0; $balance = 0; foreach ($accounts as $account) { $cr = transactions::where("\x61\143\x63\x6f\x75\156\164\137\151\144", $account->id)->sum("\143\x72"); $db = transactions::where("\x61\x63\143\157\x75\x6e\164\137\x69\x64", $account->id)->sum("\x64\x62"); $balance += $cr - $db; } return $balance; } goto ktyfF; s5y2M: function customerDues() { $accounts = account::where("\164\x79\160\145", "\143\x75\x73\x74\157\155\145\162")->get(); $cr = 0; $db = 0; $balance = 0; foreach ($accounts as $account) { $cr = transactions::where("\x61\143\143\157\x75\x6e\x74\x5f\x69\144", $account->id)->sum("\x63\x72"); $db = transactions::where("\x61\x63\143\157\165\x6e\164\137\151\144", $account->id)->sum("\144\x62"); $balance += $cr - $db; } return $balance; } goto wln7l; ktyfF: function todayCash() { $balance = 0; $date = date("\x59\x2d\x6d\55\x64"); $transactions = transactions::whereDate("\x64\141\x74\x65", $date)->whereHas("\x61\143\x63\157\x75\156\x74", function ($query) { $query->where("\x43\141\x74\145\147\x6f\x72\x79", "\103\141\163\150"); })->get(); foreach ($transactions as $transaction) { $balance += $transaction->cr; $balance -= $transaction->db; } return $balance; } goto WlrPH; v_BbW: function deleteLedger($ref) { ledger::where("\162\145\x66", $ref)->delete(); return "\114\x65\x64\147\x65\162\40\x44\x65\154\x65\164\x65\x64"; } goto eyRmI; WlrPH: function totalBank() { $accounts = account::where("\x43\141\x74\145\147\x6f\162\x79", "\x42\x61\x6e\x6b")->get(); $cr = 0; $db = 0; $balance = 0; foreach ($accounts as $account) { $cr = transactions::where("\141\143\143\157\x75\156\164\x5f\x69\x64", $account->id)->sum("\143\x72"); $db = transactions::where("\x61\143\143\157\x75\x6e\x74\x5f\x69\144", $account->id)->sum("\144\x62"); $balance += $cr - $db; } return $balance; } goto sHycF; YEnCc: function getAccountBalance($id) { $transactions = transactions::where("\x61\143\x63\x6f\x75\156\164\x49\x44", $id)->get(); $balance = 0; foreach ($transactions as $trans) { $balance += $trans->cr; $balance -= $trans->db; } return $balance; } goto s5y2M; VgCbl: function addLedger($date, $head, $type, $details, $amount, $ref) { ledger::create(array("\x64\141\x74\x65" => $date, "\150\145\x61\x64" => $head, "\164\x79\x70\x65" => $type, "\x64\x65\164\x61\151\x6c\163" => $details, "\167\x61\162\145\x68\157\165\163\x65\111\104" => auth()->user()->warehouseID, "\x61\x6d\x6f\x75\x6e\x74" => $amount, "\162\x65\146" => $ref)); return "\x4c\x65\144\147\x65\x72\x20\x41\144\144\145\144"; } goto v_BbW; nQYj0: function todayPurchase() { $Date = Carbon::now()->format("\131\55\155\x2d\144"); $purchases = purchase_details::whereDate("\x64\x61\x74\x65", $Date)->get(); $total = 0; foreach ($purchases as $item) { $total += $item->qty * $item->rate; } return $total; } goto Ss_X8; KP_u0: function updateSaleAmount($id) { $bill = sale::where("\x69\144", $id)->first(); $total = getSaleBillTotal($id); if ($bill->isPaid == "\116\x6f") { $trans = transactions::where("\x61\143\x63\157\165\156\x74\x5f\151\x64", $bill->customer_account->id)->where("\x72\x65\146", $bill->ref)->first(); $trans->cr = $total; $trans->date = $bill->date; $trans->save(); } elseif ($bill->isPaid == "\131\145\163") { $trans = transactions::where("\x61\143\x63\x6f\165\x6e\x74\137\x69\144", $bill->account->id)->where("\x72\x65\146", $bill->ref)->first(); $trans->cr = $total; $trans->date = $bill->date; $trans->save(); } else { $trans = transactions::where("\x61\x63\x63\x6f\165\156\164\x5f\151\144", $bill->customer_account->id)->where("\162\145\146", $bill->ref)->first(); $trans->cr = $total; $trans->date = $bill->date; $trans->save(); } $ledger = ledger::where("\162\x65\146", $bill->ref)->first(); $ledger->amount = $total; $ledger->save(); } goto i_6Ag; eyRmI: function cashBook() { return 0; } goto I6pRT; Dybcw: function lowStockReminder() { $products = products::all(); foreach ($products as $product) { $cr = stock::where("\160\162\x6f\x64\165\x63\164\x5f\151\x64", $product->id)->sum("\143\162"); $db = stock::where("\x70\162\157\x64\x75\143\164\x5f\x69\x64", $product->id)->sum("\144\x62"); $product->availStock = $cr - $db; if ($product->availStock < $product->alert) { $desc = "{$product->name}\40\x28{$product->brand}\51\40\x69\163\40\x6c\157\167\x20\x69\156\x20\x73\x74\157\143\x6b"; $check = tasks::where("\x64\145\x73\143\162\151\160\164\151\157\156", $desc)->count(); if ($check < 1) { tasks::create(array("\x64\x65\x73\143\x72\x69\x70\x74\151\157\x6e" => $desc, "\144\x75\145" => now())); } } } }